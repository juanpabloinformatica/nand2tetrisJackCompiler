#include "CompilationEngine.hpp"

inline std::string CompilationEngine::tokenListKey(int tokenListIndex) {
  return this->tokenList.at(tokenListIndex)->begin()->first;
}
inline JackTypes::TokenType
CompilationEngine::tokenListValue(int tokenListIndex) {
  return this->tokenList.at(tokenListIndex)->begin()->second;
}
/*With this I will be able to re-use the token-list generated by the tokenizer*/
/*I don't really get the whole process I think that the advance and stuff is to
 * move get token*/
/*and then let the compilation takes cares, nevertheless I will continue this
 * way then I will see*/
CompilationEngine::CompilationEngine(
    const std::vector<std::map<std::string, JackTypes::TokenType> *> &tokenList)
    : outputFile(std::string("./test/output_compilation.xml")),
      tokenList(tokenList), tokenListIndex(0) {
  this->compileClass();
}

void CompilationEngine::run() {
  int i = 0;
  for (const auto &element : this->tokenList) {
    for (const auto &mapa : *element) {
      std::cout << "i:" << i << "--> " << mapa.first << "\n";
    }
  }
  // this
}
void CompilationEngine::compileClass() {
  if (!(this->tokenListKey(this->tokenListIndex) == "class"))
    return;
  this->outputFile << "class\n\t";
  this->tokenListIndex++;
  if (!(this->tokenListValue(this->tokenListIndex) == JackTypes::IDENTIFIER))
    return;
  this->outputFile << "identifier\n\t";
  this->tokenListIndex++;
  if (!(this->tokenListKey(this->tokenListIndex) == "{"))
    return;
  this->outputFile << "symbol\n\t";
  this->tokenListIndex++;
  this->compileClassVarDec();
}
void CompilationEngine::compileClassVarDec() {
  if (!(this->tokenListKey(this->tokenListIndex) == "static" ||
        this->tokenListKey(this->tokenListIndex) == "field"))
    return;
  this->outputFile << "cccc\n\t";
  this->tokenListIndex++;
  if (!(this->tokenListKey(this->tokenListIndex) == "int" ||
        this->tokenListKey(this->tokenListIndex) == "char" ||
        this->tokenListKey(this->tokenListIndex) == "boolean" ||
        this->tokenListValue(this->tokenListIndex) == JackTypes::IDENTIFIER))
    return;
  this->outputFile << "type\n\t";
  this->tokenListIndex++;
  if (!(this->tokenListValue(this->tokenListIndex) == JackTypes::IDENTIFIER))
    return;
  this->outputFile << "varName\n\t";
  this->tokenListIndex++;

  // if (!(this->))
}

const std::vector<std::map<std::string, JackTypes::TokenType> *> &
CompilationEngine::getTokenList() {
  return this->tokenList;
}
CompilationEngine::~CompilationEngine() {
  std::cout << "Calling compilation engine destructor" << "\n";
}
